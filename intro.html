<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spatial Statistics for Stream Networks</title>
  <meta name="description" content="Theory and software for spatial stream network models">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Spatial Statistics for Stream Networks" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Theory and software for spatial stream network models" />
  <meta name="github-repo" content="rstudio/SpatStatStreamNet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spatial Statistics for Stream Networks" />
  
  <meta name="twitter:description" content="Theory and software for spatial stream network models" />
  

<meta name="author" content="Jay M. Ver Hoef, Erin E. Peterson, Daniel J. Isaak">


<meta name="date" content="2018-12-02">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="topology-and-distance.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Statistics for Stream Networks</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#motivating-example"><i class="fa fa-check"></i><b>1.1</b> Motivating Example</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#why-stream-network-models"><i class="fa fa-check"></i><b>1.2</b> Why Stream Network Models?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="topology-and-distance.html"><a href="topology-and-distance.html"><i class="fa fa-check"></i><b>2</b> Topology and Distance</a><ul>
<li class="chapter" data-level="2.1" data-path="topology-and-distance.html"><a href="topology-and-distance.html#StreamTopo"><i class="fa fa-check"></i><b>2.1</b> Stream Topology</a><ul>
<li class="chapter" data-level="2.1.1" data-path="topology-and-distance.html"><a href="topology-and-distance.html#StreamsR"><i class="fa fa-check"></i><b>2.1.1</b> Streams in R</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="topology-and-distance.html"><a href="topology-and-distance.html#DualCoord"><i class="fa fa-check"></i><b>2.2</b> Dual Coordinate Systems</a></li>
<li class="chapter" data-level="2.3" data-path="topology-and-distance.html"><a href="topology-and-distance.html#StreamDist"><i class="fa fa-check"></i><b>2.3</b> Stream Distance</a></li>
<li class="chapter" data-level="2.4" data-path="topology-and-distance.html"><a href="topology-and-distance.html#additive-function"><i class="fa fa-check"></i><b>2.4</b> Additive Function</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ChapMA.html"><a href="ChapMA.html"><i class="fa fa-check"></i><b>3</b> Models for Autocorrelation</a><ul>
<li class="chapter" data-level="3.1" data-path="ChapMA.html"><a href="ChapMA.html#DiscreteTS"><i class="fa fa-check"></i><b>3.1</b> Discrete Time Series</a><ul>
<li class="chapter" data-level="3.1.1" data-path="ChapMA.html"><a href="ChapMA.html#definition-and-construction"><i class="fa fa-check"></i><b>3.1.1</b> Definition and Construction</a></li>
<li class="chapter" data-level="3.1.2" data-path="ChapMA.html"><a href="ChapMA.html#MomentsDiscreteTS"><i class="fa fa-check"></i><b>3.1.2</b> Properties</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ChapMA.html"><a href="ChapMA.html#continuous-time-series"><i class="fa fa-check"></i><b>3.2</b> Continuous Time Series</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ChapMA.html"><a href="ChapMA.html#definition-and-construction-1"><i class="fa fa-check"></i><b>3.2.1</b> Definition and Construction</a></li>
<li class="chapter" data-level="3.2.2" data-path="ChapMA.html"><a href="ChapMA.html#properties"><i class="fa fa-check"></i><b>3.2.2</b> Properties</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ChapMA.html"><a href="ChapMA.html#TUModels"><i class="fa fa-check"></i><b>3.3</b> Tail-up Models</a></li>
<li class="chapter" data-level="3.4" data-path="ChapMA.html"><a href="ChapMA.html#TDModels"><i class="fa fa-check"></i><b>3.4</b> Tail-Down Models</a></li>
<li class="chapter" data-level="3.5" data-path="ChapMA.html"><a href="ChapMA.html#euclidean-distance-models"><i class="fa fa-check"></i><b>3.5</b> Euclidean Distance Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html"><i class="fa fa-check"></i><b>4</b> Spatial Linear Model</a><ul>
<li class="chapter" data-level="4.1" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html#variance-components"><i class="fa fa-check"></i><b>4.1</b> Variance Components</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html#semivariograms"><i class="fa fa-check"></i><b>4.2</b> Semivariograms</a></li>
<li class="chapter" data-level="4.3" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html#estimation"><i class="fa fa-check"></i><b>4.3</b> Estimation</a><ul>
<li class="chapter" data-level="4.3.1" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html#quasi-models"><i class="fa fa-check"></i><b>4.3.1</b> Quasi Models</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html#prediction"><i class="fa fa-check"></i><b>4.4</b> Prediction</a><ul>
<li class="chapter" data-level="4.4.1" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html#block-prediction"><i class="fa fa-check"></i><b>4.4.1</b> Block Prediction</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="spatial-linear-model.html"><a href="spatial-linear-model.html#model-diagnostics"><i class="fa fa-check"></i><b>4.5</b> Model Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>5</b> Applications</a><ul>
<li class="chapter" data-level="5.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Statistics for Stream Networks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Introduction</h1>
<style type="text/css">
caption, .caption{
  font-style:italic;
  margin-top:0.5em;
  margin-bottom:0.5em;
  width:99%;
  text-align: left;
}
body{
  font-family: Times-Roman;
  font-size: 11pt;
}
p {line-height: 2em;}
tr:nth-child(even) {background-color: #f2f2f2;}
th {
    background-color: #4CAF50;
    color: black;
}
p {
padding-bottom: 15px;
}

</style>
<p>Spatial statistical models are broadly applied within the fields of geology, geography, ecology, real estate, and medicine, just to name a few. Spatial statistical models often have two broad goals: 1) to describe how covariates affect a response variable, and 2) to make predictions at unsampled locations. For example, data might be used to fit a model establishing a relationship between elevation and air temperature, and also to make a map of air temperature based on a dense set of predictions. When fitting the model and making predictions, a spatial statistical model uses a covariance matrix composed of autocovariance values that rely on Euclidean distances (from straight lines in two dimensions) among all sites. Distances for stream networks, however, are poorly represented by Euclidean distances because fish and water quality attributes do not move over land but follow the sinuous pattern of the network. To apply traditional spatial statistical modeling techniques, those distances must be accurately represented in a covariance matrix structure for stream networks. This chapter provides an overview of recent research on this topic and a new class of spatial-stream network (SSN) model that is being used for an increasing number of applications.</p>
<p><span class="citation">Ver Hoef, Peterson, and Theobald (<a href="#ref-Ver:Pete:Theo:spat:2006">2006</a>)</span> and <span class="citation">Cressie et al. (<a href="#ref-Cres:Frey:Harc:Smit:spat:2006">2006</a>)</span> initially described new models for stream networks based on moving average constructions. The models used stream distance, which was defined as the shortest distance between two locations computed only along the stream network. <span class="citation">(Peterson, Theobald, and Ver Hoef <a href="#ref-Pete:Theo:Ver:supp:2007">2007</a>)</span> provide in-depth discussion on the statistical and ecological consequences of substituting stream distance measures for Euclidean distance. The original work defined a class where the moving average function was termed “tail-up,” and further models with a “tail-down” moving average function were described by <span class="citation">(Ver Hoef and Peterson <a href="#ref-Ver:Pete:Move:2010">2010</a><a href="#ref-Ver:Pete:Move:2010">b</a>)</span>, and we give further details below. Both types of models were necessary to cover a range of autocorrelation possibilities, so a variance component approach, combining tail-up, tail-down, and classical geostatistical models based on Euclidean distance, was promoted in <span class="citation">Garreta, Monestiez, and Ver Hoef (<a href="#ref-Garr:Mone:Ver:spat:2009">2009</a>)</span>, <span class="citation">Peterson and Ver Hoef (<a href="#ref-Pete:Ver:mixe:2010">2010</a>)</span> and <span class="citation">Ver Hoef and Peterson (<a href="#ref-Ver:Pete:Move:2010">2010</a><a href="#ref-Ver:Pete:Move:2010">b</a>)</span>. Although SSN models are most often used for streams, they can be generalized to other dendritic networks <span class="citation">(Peterson et al. <a href="#ref-Pete:Ver:Isaa:stre:2013">2013</a>)</span>.</p>
<p>Because each stream topology is unique, prior to fitting the SSN models, data are preprocessed to develop distance and weighting matrices in a geographical information system (GIS) using the STARS (Spatial Tools for the Analysis of River Systems) custom toolset <span class="citation">(Peterson and Ver Hoef <a href="#ref-Pete:Ver:STAR:2014">2014</a>})</span> for ArcGIS <span class="citation">(ESRI <a href="#ref-ESRI:ArcG:2014">2014</a>)</span>. STARS produces the spatial, topological, and attribute information needed to fit a SSN model using the <strong>SSN</strong> package <span class="citation">(Ver Hoef et al. <a href="#ref-Ver:Pete:Clif:Shah:SSN:2014">2014</a>)</span> with the <strong>R</strong> statistical software <span class="citation">(R Core Team <a href="#ref-R:Deve:Core:ALan:2015">2015</a>)</span>.</p>
<p>New spatial statistical methods were recently developed to fit models to data collected on stream (river) networks <span class="citation">(Ver Hoef and Peterson <a href="#ref-Ver:Pete:Move:2010">2010</a><a href="#ref-Ver:Pete:Move:2010">b</a>)</span>. Stream networks, in our usage, are based on a mathematical topology that represents streams as line segments that converge downstream, or viewed conversely, that create dichotomous branching when moving upstream from an outlet (the most downstream location in the network). A number of packages (including, but not limited to, <strong>geoR</strong> <span class="citation">(Ribeiro and Diggle <a href="#ref-Ribe:Digg:geoR:2001">2001</a>)</span>, <strong>spatial</strong> <span class="citation">(Venables and Ripley <a href="#ref-Vene:Ripl:mode:2002">2002</a>)</span>, <strong>geoRglm</strong> <span class="citation">(Christensen and Ribeiro <a href="#ref-Chri:Ribe:geoR:2002">2002</a>)</span>, <strong>gstat</strong> <span class="citation">(Pebesma <a href="#ref-Pebe:mult:2004">2004</a>})</span>,
<strong>fields</strong> <span class="citation">(Fields Development Team <a href="#ref-Fiel:Deve:Team:2006">2006</a>)</span>, <strong>spBayes</strong> <span class="citation">(Finley, Banerjee, and Carlin <a href="#ref-Finl:Bane:Carl:spBa:2007">2007</a>)</span>, and <strong>ramps</strong>
<span class="citation">(Smith, Yan, and Cowles <a href="#ref-Smit:Yan:Cowl:unif:2008">2008</a>)</span>) have been written in <strong>R</strong> to fit spatial statistical models that use geostatistical autocovariance functions (based on Euclidean distance), but they are not guaranteed to produce positive-definite covariance matrices when using an alternative distance measure, such as stream distance <span class="citation">(Ver Hoef, Peterson, and Theobald <a href="#ref-Ver:Pete:Theo:spat:2006">2006</a>)</span>. In this book, we present the <strong>R</strong> package <strong>SSN</strong>, which allows users to fit autocovariance functions developed for stream networks <span class="citation">(Ver Hoef and Peterson <a href="#ref-Ver:Pete:Move:2010">2010</a><a href="#ref-Ver:Pete:Move:2010">b</a>)</span>. These models are unique because they use distance measured along the network, they incorporate flow direction,
and they allow covariance weighting when segments converge (e.g., by volume of flowing water). We develop two classes of covariance models based on moving average constructions that we call the tail-up and tail-down models. These models may also be combined in a mixed model strategy that includes models based on Euclidean distance. Such geostatistical mixed models are important because they can account for
multiple processes of spatial autocorrelation in stream systems, including those that occur within the stream and others that result from the straight-line distances due to the terrestrial environment
<span class="citation">(Ver Hoef and Peterson <a href="#ref-Ver:Pete:Move:2010">2010</a><a href="#ref-Ver:Pete:Move:2010">b</a>)</span>.</p>
<div id="motivating-example" class="section level2">
<h2><span class="header-section-number">1.1</span> Motivating Example</h2>
<p>Organisms that live in streams and rivers are ectothermic and so temperature profoundly affects their ecology. Concerns about climate change and habitat alteration that degrade thermal environments have led to extensive stream temperature monitoring in previous decades by dozens of natural resources agencies throughout North American and Europe. In the American West, the NorWeST (Northwest Stream Temperature) project has aggregated and organized, from $&gt;$100 natural resource agencies, most of the digital temperature records collected using miniature sensors into a massive online database</p>
<p><a href="http://www.fs.fed.us/rm/boise/AWAE/projects/NorWeST.html" class="uri">http://www.fs.fed.us/rm/boise/AWAE/projects/NorWeST.html</a></p>
<p>The database hosts $&gt;$200 million hourly temperature recordings measured at $&gt;$20,000 unique stream sites. SSN models have been used with a subset of the data to create prediction maps and develop a consistent set of high-resolution climate scenarios. The project is on-going, but prediction map scenarios at a 1-km resolution have been developed for $&gt;$500,000 kilometers of streams and rivers <a href="intro.html#fig:Fig-Blob">1.1</a>. Detailed maps of higher resolution are available for download, and an interactive map that allows zooming and panning are available at the NorWeST website.</p>
<div class="figure" style="text-align: center"><span id="fig:Fig-Blob"></span>
<img src="/SpatStatStreamNet_files/figure-html/Fig-Blob.png" alt="a) Locations of temperature records measured with sensors at $&gt;$20,000 unique stream sites in the NorWeST database, where the blue lines are streams, and the solid black circles are locations. b) Mean August temperature predictions throughout most of the western United States using methods described in this book." width="90%" />
<p class="caption">
Figure 1.1: a) Locations of temperature records measured with sensors at $&gt;$20,000 unique stream sites in the NorWeST database, where the blue lines are streams, and the solid black circles are locations. b) Mean August temperature predictions throughout most of the western United States using methods described in this book.
</p>
</div>
<p>Based on leave-one-out crossvalidation there was an <span class="math inline">\(r^2\)</span> of 0.90 between true and predicted temperature values at observed sites, with a root-mean-squared prediction error (RMSPE) of 1.0<span class="math inline">\(^0\)</span>C across all streams. The accuracy of the SSN temperature model used to develop the scenarios, and the model’s ability to extract reliable information from large, non-random datasets collected by the management community, has led to the rapid adoption and broad use of NorWeST scenarios for conservation planning. The scenarios have been used to precisely identify climate refugia for cold-water fishes such as trout and char <span class="citation">(Isaak et al. <a href="#ref-Isaa:Youn:Nage:Hora:Groc:2015:cold">2015</a>, <a href="#ref-Isaa:Youn:Luce:Host:slow:2016">2016</a>)</span>, characterize thermal niches of fish and amphibian species <span class="citation">(Al-Chokhachy et al. <a href="#ref-Al:Schm:Clan:Saff:Kova:others:brow:2016">2016</a>; D. J. Isaak, Wenger, and Young <a href="#ref-Isaa:Weng:Youn:big:2017">2017</a>)</span>, describe how salmon migrations are affected by temperature <span class="citation">(Westley et al. <a href="#ref-West:Ditt:Ward:Quin:sign:2015">2015</a>)</span>, and estimate the distribution and abundance of fish populations <span class="citation">(Dauwalter, Fesenmyer, and Bjork <a href="#ref-Dauw:Fese:Bjor:Usin:2015">2015</a>; D. J. Isaak, Ver Hoef, et al. <a href="#ref-Isaa:Ver:Pete:Hora:Nage:scal:2017">2017</a>)</span>.</p>
<p>To illustrate statistical methods for stream networks in this Chapter, we use a very small subset of the NorWeST data. The stream network and sampling locations for the example are shown in Figure <a href="intro.html#fig:Fig-StudyArea">1.2</a></p>
<div class="figure" style="text-align: center"><span id="fig:Fig-StudyArea"></span>
<img src="//SpatStatStreamNet_files/figure-html/StudyArea.png" alt="The study area in central Idaho, where average August temperature data were collected from the Middle Fork of the Salmon River in 2004. The sample locations are shown as solid black circles." width="70%" />
<p class="caption">
Figure 1.2: The study area in central Idaho, where average August temperature data were collected from the Middle Fork of the Salmon River in 2004. The sample locations are shown as solid black circles.
</p>
</div>
</div>
<div id="why-stream-network-models" class="section level2">
<h2><span class="header-section-number">1.2</span> Why Stream Network Models?</h2>
<p>Many researchers have called for using stream distance, rather than Euclidean distance, when developing spatial statistical models for stream networks <span class="citation">(Dent and Grimm <a href="#ref-Dent:Grim:spat:1999">1999</a>; Torgersen, Gresswell, and Bateman <a href="#ref-Torg:Gres:Bate:patt:2004">2004</a>; Yuan <a href="#ref-Yuan:usin:2004">2004</a>)</span>. There is a problem, however, if we simply use stream distance, rather than Euclidean distance, in a standard geostatistical autocovariance model <span class="citation">(e.g., a large number geostatistical models based on Euclidean distance can be found in Chiles and Delfiner <a href="#ref-Chil:Delf:geos:1999">1999</a>, 80–97)</span>. To illustrate, we computed stream distances between all pairs of stream locations shown in Figure <a href="intro.html#fig:Fig-StudyArea">1.2</a>, and then used stream distances (rather than Euclidean distances) in five commonly-used autocovariance models from geostatistics. For all 5 models, the “nugget” effect was set to zero and the “partial sill” was set to 1. The parameter that controls the amount of autocorrelation, often called the “range,” was allowed to vary. For each value of the range for each model, a spatial covariance matrix was determined based on stream distance among the 90 locations in Figure <a href="intro.html#fig:Fig-StudyArea">1.2</a>. The minimum eigenvalue as a function of the range is shown in Figure <a href="intro.html#fig:Fig-testEucValid">1.3</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:Fig-testEucValid"></span>
<img src="SpatStatStreamNet_files/figure-html/Fig-testEucValid-1.png" alt="Minimum eigenvalues of spatial covariance matrices for classic geostatistical models based on Euclidean distances, for various range parameters (in log base 2 meters), but when using using stream distance, rather than Euclidean distance, among all locations shown in the Study Area Figure" width="70%" />
<p class="caption">
Figure 1.3: Minimum eigenvalues of spatial covariance matrices for classic geostatistical models based on Euclidean distances, for various range parameters (in log base 2 meters), but when using using stream distance, rather than Euclidean distance, among all locations shown in the Study Area Figure
</p>
</div>
<p>Notice that negative eigenvalues mean that the covariance matrix is not positive definite, and hence not valid. Figure <a href="intro.html#fig:Fig-testEucValid">1.3</a> demonstrates that the linear-with-sill, rational quadratic, and Gaussian models are not valid when using stream distance for this data set for certain range values. This illustrates that simple substitution of stream network distance for Euclidean distance does not guarantee valid models, in the sense that the covariance matrix is not guaranteed to be positive definite. Even when a model appears to be valid for all range values for a given data set, such as the exponential or spherical models in Figure <a href="intro.html#fig:Fig-testEucValid">1.3</a>, there is no guarantee that additional points, e.g. for prediction purposes, will keep covariance matrices positive definite. Similarly, a change in network configuration could cause these models to fail; indeed, <span class="citation">Ver Hoef, Peterson, and Theobald (<a href="#ref-Ver:Pete:Theo:spat:2006">2006</a>)</span> show a network where the spherical model has negative eigenvalues. Despite this, some researchers continue to erroneously substitute network distance into models designed for geostatistics. Thus, in order to use stream distance rather than Euclidean distance, another approach is indicated.</p>
<p>Even though substituting stream distance for Euclidean distance does not guarantee valid models, it is fair to ask why use stream distance at all? Fitting SSN models requires more effort than fitting standard geostatistical methods. Calculating stream distances, and weighting stream segments (as we will describe below) requires considerable GIS computation, whereas Euclidean distance can be readily calculated in R (or any software) without a GIS. What is gained by the stream network models? Consider a simple example using the data in Figure <a href="intro.html#fig:Fig-StudyArea">1.2</a>. We withheld one measurement, the open circle in Figure <a href="intro.html#fig:Fig-whyStreamNet">1.4</a>, which also shows its two closest locations (solid circles).</p>
<div class="figure" style="text-align: center"><span id="fig:Fig-whyStreamNet"></span>
<img src="SpatStatStreamNet_files/figure-html/Fig-whyStreamNet-1.png" alt="A comparison of ordinary kriging predictions, using a covariance matrix based on Euclidean distance, and predictions from a stream network model, using a covariance matrix based on stream distance and flow information.  The values at the solid circles are used as observed data to predict the value at the open circle. The real value at the open circle is given, along with predictions for the two models with 90% prediction invervals." width="70%" />
<p class="caption">
Figure 1.4: A comparison of ordinary kriging predictions, using a covariance matrix based on Euclidean distance, and predictions from a stream network model, using a covariance matrix based on stream distance and flow information. The values at the solid circles are used as observed data to predict the value at the open circle. The real value at the open circle is given, along with predictions for the two models with 90% prediction invervals.
</p>
</div>
<p>We predicted the withheld observation using ordinary kriging <span class="citation">(Cressie <a href="#ref-Cres:stat:1993">1993</a>)</span> based on Euclidean distance, and also predicted it based on a stream-network model <span class="citation">(Ver Hoef and Peterson <a href="#ref-Ver:Pete:Move:2010">2010</a><a href="#ref-Ver:Pete:Move:2010">b</a>)</span> that we will discuss in greater detail below. Ordinary kriging, based on Euclidean distance, predicted a value for the withheld location of 13.1<span class="math inline">\(^{\circ}\)</span>C, with a 90% prediction interval of <span class="math inline">\(\pm\)</span> 2.74<span class="math inline">\(^{\circ}\)</span>C. A tail-up stream-network model predicted a lower value of 9.4<span class="math inline">\(^0\)</span>C, with a prediction interval of <span class="math inline">\(\pm\)</span> 1.75<span class="math inline">\(^{\circ}\)</span>C. Both intervals capture the true value, but the stream network prediction is more accurate. However, there is more of interest. Recall that ordinary kriging generally weights nearby locations most heavily, and the prediction, 13.1, is somewhere between observed values 12.3 and 15.0. From this perspective, the Euclidean model produces a sensible prediction (Figure <a href="intro.html#fig:Fig-whyStreamNet">1.4</a>). Yet, this is not logically consistent for a flowing stream. Notice that the temperature decreased from 15.0<span class="math inline">\(^{\circ}\)</span>C to 12.3<span class="math inline">\(^{\circ}\)</span>C downstream between the two observed locations on the main stream segment (thicker line), even though temperature generally increases while going downstream. This suggests that the unobserved tributary added cold water, causing the drop in temperature. Logically, the downstream temperature of 12.3<span class="math inline">\(^{\circ}\)</span>C should be some weighted average of temperatures from the two upstream segments; one with a temperature of 15.0<span class="math inline">\(^{\circ}\)</span>C, and while the other temperature is unknown, it is surely less than 12.3<span class="math inline">\(^{\circ}\)</span>C. Thus, the ordinary kriging estimate of 13.1<span class="math inline">\(^{\circ}\)</span>C is not logically consistent, whereas the estimate from the stream-network model, 9.4<span class="math inline">\(^{\circ}\)</span>C, is logically consistent. Although this is but a single prediction, we have observed this type of difference between ordinary kriging and stream network model predictions on many occasions, where the stream network model tends to reflect the topological constraints and the effect of flow on correlation structure. A similar example is given by <span class="citation">Peterson et al. (<a href="#ref-Pete:Ver:Isaa:stre:2013">2013</a>)</span>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Ver:Pete:Theo:spat:2006">
<p>Ver Hoef, Jay M., Erin E. Peterson, and David Theobald. 2006. “Spatial Statistical Models That Use Flow and Stream Distance.” <em>Environmental and Ecological Statistics</em> 13 (1): 449–64.</p>
</div>
<div id="ref-Cres:Frey:Harc:Smit:spat:2006">
<p>Cressie, Noel, Jesse Frey, Bronwyn Harch, and Mick Smith. 2006. “Spatial Prediction on a River Network.” <em>Journal of Agricultural, Biological, and Environmental Statistics</em> 11 (2): 127–50.</p>
</div>
<div id="ref-Pete:Theo:Ver:supp:2007">
<p>Peterson, E. E., D. M. Theobald, and Ver HoefJ. M. 2007. “Geostatistical Modeling on Stream Networks: Developing Valid Covariance Matrices Based on Hydrologic Distance and Stream Flow.” <em>Freshwater Biology</em> 52: 267–79.</p>
</div>
<div id="ref-Ver:Pete:Move:2010">
<p>Ver Hoef, J. M., and E. Peterson. 2010b. “A Moving Average Approach for Spatial Statistical Models of Stream Networks (with Discussion).” <em>Journal of the American Statistical Association</em> 105: 6–18. <a href="https://doi.org/10.1198/jasa.2009.ap08248; Rejoinder pgs. 22 - 24">https://doi.org/10.1198/jasa.2009.ap08248; Rejoinder pgs. 22 - 24</a>.</p>
</div>
<div id="ref-Garr:Mone:Ver:spat:2009">
<p>Garreta, Vincent, Pascal Monestiez, and Ver HoefJay M. 2009. “Spatial Modelling and Prediction on River Networks: Up Model,down Model, or Hybrid.” <em>Environmetrics</em> 21: 439–56, DOI:10.1002/env.995.</p>
</div>
<div id="ref-Pete:Ver:mixe:2010">
<p>Peterson, E. E., and Ver HoefJ. M. 2010. “A Mixed-Model Moving-Average Approach to Geostatistical Modeling in Stream Networks.” <em>Ecology</em> 93 (3): 644–51.</p>
</div>
<div id="ref-Pete:Ver:Isaa:stre:2013">
<p>Peterson, E. E., Ver HoefJ. M., D. J. Isaak, J. A. Falke, M-J Fortin, C. Jordan, K. McNyset, et al. 2013. “Stream Networks in Space: Concepts, Models, and Synthesis.” <em>Ecology Letters</em> 16: 707–19. <a href="https://doi.org/10.1111/ele.12084.">https://doi.org/10.1111/ele.12084.</a></p>
</div>
<div id="ref-Pete:Ver:STAR:2014">
<p>Peterson, Erin E, and Ver HoefJay M. 2014. “STARS: An Arcgis Toolset Used to Calculate the Spatial Information Needed to Fit Spatial Statistical Models to Stream Network Data.” <em>Journal of Statisticla Software</em> 56 (2): 1–17.</p>
</div>
<div id="ref-ESRI:ArcG:2014">
<p>ESRI. 2014. “ArcGIS Desktop: Release 10.3.” Redlands, CA: Environmental Systems Research Institute.</p>
</div>
<div id="ref-Ver:Pete:Clif:Shah:SSN:2014">
<p>Ver Hoef, J. M., E.E. Peterson, D. Clifford, and R. Shah. 2014. “SSN: An R Package for Spatial Statistical Modeling on Stream Networks.” <em>Journal of Statistical Software</em> 56 (3): 1–45.</p>
</div>
<div id="ref-R:Deve:Core:ALan:2015">
<p>R Core Team. 2015. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="http://www.R-project.org">http://www.R-project.org</a>.</p>
</div>
<div id="ref-Ribe:Digg:geoR:2001">
<p>Ribeiro, Jr, Paulo J., and Peter J. Diggle. 2001. “GeoR: A Package for Geostatistical Analysis.” <em>R-NEWS</em> 1 (2): 14–18. <a href="http://CRAN.R-project.org/doc/Rnews/">http://CRAN.R-project.org/doc/Rnews/</a>.</p>
</div>
<div id="ref-Vene:Ripl:mode:2002">
<p>Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics with S</em>. Fourth. New York: Springer. <a href="http://www.stats.ox.ac.uk/pub/MASS4">http://www.stats.ox.ac.uk/pub/MASS4</a>.</p>
</div>
<div id="ref-Chri:Ribe:geoR:2002">
<p>Christensen, O.F., and Jr Ribeiro Paulo J. 2002. “GeoRglm - a Package for Generalised Linear Spatial Models.” <em>R News</em> 2 (2): 26–28. <a href="http://cran.R-project.org/doc/Rnews">http://cran.R-project.org/doc/Rnews</a>.</p>
</div>
<div id="ref-Pebe:mult:2004">
<p>Pebesma, Edzer J. 2004. “Multivariable Geostatistics in S: The Gstat Package.” <em>Computers &amp; Geosciences</em> 30: 683–91.</p>
</div>
<div id="ref-Fiel:Deve:Team:2006">
<p>Fields Development Team. 2006. “Fields: Tools for Spatial Data. National Center for Atmospheric Research, Boulder, Co.” http://www.cgd.ucar.edu/Software/Fields.</p>
</div>
<div id="ref-Finl:Bane:Carl:spBa:2007">
<p>Finley, Andrew O., Sudipto Banerjee, and Bradley P. Carlin. 2007. “SpBayes: An R Package for Univariate and Multivariate Hierarchical Point-Referenced Spatial Models.” <em>Journal of Statistical Software</em> 19 (4): 1–24. <a href="http://www.jstatsoft.org/v19/i04">http://www.jstatsoft.org/v19/i04</a>.</p>
</div>
<div id="ref-Smit:Yan:Cowl:unif:2008">
<p>Smith, Brian J., Jun Yan, and Mary Kathryn Cowles. 2008. “Unified Geostatistical Modeling for Data Fusion and Spatial Heteroskedasticity with R Package Ramps.” <em>Journal of Statistical Software</em> 25 (10): 1–21. <a href="http://www.jstatsoft.org/v25/i10">http://www.jstatsoft.org/v25/i10</a>.</p>
</div>
<div id="ref-Isaa:Youn:Nage:Hora:Groc:2015:cold">
<p>Isaak, Daniel J, Michael K Young, David E Nagel, Dona L Horan, and Matthew C Groce. 2015. “The Cold-Water Climate Shield: Delineating Refugia for Preserving Salmonid Fishes Through the 21st Century.” <em>Global Change Biology</em> 21 (7): 2540–53.</p>
</div>
<div id="ref-Isaa:Youn:Luce:Host:slow:2016">
<p>Isaak, Daniel J, Michael K Young, Charles H Luce, Steven W Hostetler, Seth J Wenger, Erin E Peterson, Ver HoefJay M, Matthew C Groce, Dona L Horan, and David E Nagel. 2016. “Slow Climate Velocities of Mountain Streams Portend Their Role as Refugia for Cold-Water Biodiversity.” <em>Proceedings of the National Academy of Sciences</em>, 201522429.</p>
</div>
<div id="ref-Al:Schm:Clan:Saff:Kova:others:brow:2016">
<p>Al-Chokhachy, Robert, David A Schmetterling, Chris Clancy, Patrick Saffel, Ryan P Kovach, Leslie G Nyce, Brad Liermann, Wade A Fredenberg, and Ron Pierce. 2016. “Are Brown Trout Replacing or Displacing Bull Trout Populations in a Changing Climate?” <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 73 (9): 1395–1404.</p>
</div>
<div id="ref-Isaa:Weng:Youn:big:2017">
<p>Isaak, Daniel J, Seth Wenger, and Michael K Young. 2017. “Big Biology Meets Microclimatology: Defining Thermal Niches of Aquatic Ectotherms at Landscape Scales for Conservation Planning.” <em>Ecological Applications</em> In Press.</p>
</div>
<div id="ref-West:Ditt:Ward:Quin:sign:2015">
<p>Westley, Peter AH, Andrew H Dittman, Eric J Ward, and Thomas P Quinn. 2015. “Signals of Climate, Conspecific Density, and Watershed Features in Patterns of Homing and Dispersal by Pacific Salmon.” <em>Ecology</em> 96 (10): 2823–33.</p>
</div>
<div id="ref-Dauw:Fese:Bjor:Usin:2015">
<p>Dauwalter, Daniel C, Kurt A Fesenmyer, and Robin Bjork. 2015. “Using Aerial Imagery to Characterize Redband Trout Habitat in a Remote Desert Landscape.” <em>Transactions of the American Fisheries Society</em> 144 (6): 1322–39.</p>
</div>
<div id="ref-Isaa:Ver:Pete:Hora:Nage:scal:2017">
<p>Isaak, Daniel J, Ver HoefJay M, Erin E Peterson, Dona Horan, and Dave Nagel. 2017. “Scalable Population Estimates Using Spatial-Stream-Network (Ssn) Models, Fish Density Surveys, and National Geospatial Database Frameworks for Streams.” <em>Canadian Journal of Fisheries and Aquatic Sciences</em> in press.</p>
</div>
<div id="ref-Dent:Grim:spat:1999">
<p>Dent, C. I., and N. B. Grimm. 1999. “Spatial Heterogeneity of Stream Water Nutrient Concentrations over Successional Time.” <em>Ecology</em> 80: 2283–98.</p>
</div>
<div id="ref-Torg:Gres:Bate:patt:2004">
<p>Torgersen, Christian E., R. E. Gresswell, and D. S. Bateman. 2004. “Pattern Detection in Stream Networks: Quantifying Spatial Variability in Fish Distribution.” In <em>Proceedings of the Second Annual International Symposium on Gisspatial Analyses in Fishery and Aquatic Sciences</em>, edited by T. Nishida, P. J. Kailola, and C. E. Hollingworth, 405–20. Saitama, Japan: Fishery GIS Research Group.</p>
</div>
<div id="ref-Yuan:usin:2004">
<p>Yuan, L. L. 2004. “Using Spatial Interpolation to Estimate Stressor Levels in Unsampled Streams.” <em>Environmental Monitoring and Assessment</em> 94 (1): 23–38.</p>
</div>
<div id="ref-Chil:Delf:geos:1999">
<p>Chiles, Jean-Paul, and Pierre Delfiner. 1999. <em>Geostatistics: Modeling Spatial Uncertainty</em>. New York: John Wiley &amp; Sons.</p>
</div>
<div id="ref-Cres:stat:1993">
<p>Cressie, Noel A. C. 1993. <em>Statistics for Spatial Data</em>. New York: John Wiley &amp; Sons.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="topology-and-distance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-intro.Rmd",
"text": "Edit"
},
"download": ["SpatStatStreamNet.pdf", "SpatStatStreamNet.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
